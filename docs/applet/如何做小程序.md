# 如何做一个小程序

## 小程序与普通网页开发的区别

- 小程序的主要开发语言是 JavaScript
- 小程序的逻辑层和渲染层是分开的，逻辑层运行在 JSCore 中，并没有一个完整浏览器对象，因而缺少相关的DOM API和BOM API。
- 这一区别导致了前端开发非常熟悉的一些库，例如 jQuery、 Zepto 等，在小程序中是无法运行的。
- 同时 JSCore 的环境同 NodeJS 环境也是不尽相同，所以一些 NPM 的包在小程序中也是无法运行的。
- 网页开发者面对的是各式各样的浏览器，而小程序面对的是iOS和Andriod的微信客户端及小程序开发工具。
- ​网页开发者在开发网页的时候，只需要使用到浏览器，并且搭配上一些辅助工具或者编辑器即可。小程序的开发则有所不同，需要经过申请小程序帐号、安装小程序开发者工具、配置项目等等过程方可完成。

## 账号

- 需要AppId
- [开发工具](https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html)

## 小程序代码构成

### .json 后缀的 JSON 配置文件
> JSON 是一种数据格式，并不是编程语言，在小程序中，JSON扮演的静态配置的角色。
> 我们可以看到在项目的根目录有一个 app.json 和 project.config.json，此外在 pages/logs 目录下还有一个 logs.json，我们依次来说明一下它们的用途。

- **小程序配置 app.json**
    > app.json 是当前小程序的全局配置，包括了小程序的所有页面路径、界面表现、网络超时时间、底部 tab 等。QuickStart 项目里边的 app.json 配置内容如下：

    ```JSON
    {
        "pages":[
            //pages字段 —— 用于描述当前小程序所有页面路径，这是为了让微信客户端知道
            //当前你的小程序页面定义在哪个目录。
            "pages/index/index",
            "pages/logs/logs"
        ],
        "window":{
            //window字段 —— 定义小程序所有页面的顶部背景颜色，文字颜色定义等。
            "backgroundTextStyle":"light",
            "navigationBarBackgroundColor": "#fff",
            "navigationBarTitleText": "Weixin",
            "navigationBarTextStyle":"black"
        },
        "tabBar": {
            "list": [{
            "pagePath": "pages/index/index",
            "text": "首页"
            }, {
            "pagePath": "pages/logs/index",
            "text": "日志"
            }]
        },
        "networkTimeout": {
            "request": 10000,
            "downloadFile": 10000
        },
        "debug": true
    }   
    ```
- **工具配置 project.config.json**
    > 通常大家在使用一个工具的时候，都会针对各自喜好做一些个性化配置，例如界面颜色、编译配置等等，当你换了另外一台电脑重新安装工具的时候，你还要重新配置。

    > 考虑到这点，小程序开发者工具在每个项目的根目录都会生成一个 project.config.json，你在工具上做的任何配置都会写入到这个文件，当你重新安装工具或者换电脑工作时，你只要载入同一个项目的代码包，开发者工具就自动会帮你恢复到当时你开发项目时的个性化配置，其中会包括编辑器的颜色、代码上传时自动压缩等等一系列选项。
- **页面配置 page.json**
    > 这里的 page.json 其实用来表示 pages/logs 目录下的 logs.json 这类和小程序页面相关的配置。

    > 如果你整个小程序的风格是蓝色调，那么你可以在 app.json 里边声明顶部颜色是蓝色即可。实际情况可能不是这样，可能你小程序里边的每个页面都有不一样的色调来区分不同功能模块，因此我们提供了 page.json，让开发者可以独立定义每个页面的一些属性，例如刚刚说的顶部颜色、是否允许下拉刷新等等。

    ```json
    {
        "navigationBarBackgroundColor": "#ffffff",
        "navigationBarTextStyle": "black",
        "navigationBarTitleText": "微信接口功能演示",
        "backgroundColor": "#eeeeee",
        "backgroundTextStyle": "light"
    }
    ```

- **JSON语法**
    > JSON配置的一些注意事项
    - JSON文件都是被包裹在一个大括号中 {}，通过key-value的方式来表达数据。JSON的Key必须包裹在一个双引号中，在实践中，编写 JSON 的时候，忘了给 Key 值加双引号或者是把双引号写成单引号是常见错误。

    JSON的值只能是以下几种数据格式，其他任何格式都会触发报错，例如 JavaScript 中的 undefined。

    - 数字，包含浮点数和整数
    - 字符串，需要包裹在双引号中
    - Bool值，true 或者 false
    - 数组，需要包裹在方括号中 []
    - 对象，需要包裹在大括号中 {}
    - Null
    - 还需要注意的是 JSON 文件中无法使用注释，试图添加注释将会引发报错。


### .wxml 后缀的WXML模板文件

- 相当于网页中的HTML，WXML 由标签、属性等等构成。

```HTML
<view class="container">
  <view class="userinfo">
    <button wx:if="{{!hasUserInfo && canIUse}}"> 获取头像昵称 </button>
    <block wx:else>
      <image src="{{userInfo.avatarUrl}}" background-size="cover"></image>
      <text class="userinfo-nickname">{{userInfo.nickName}}</text>
    </block>
  </view>
  <view class="usermotto">
    <text class="user-motto">{{motto}}</text>
  </view>
</view>
```

**HTML与WXML的区别**

  - 标签名不一样
      > 小程序的WXML用的标签是 view,button,text等。还提供了地图、视频、音频等组件能力
  - 多了一些wx:if这样的属性及{{}}的表达式
      > 在网页的一般开发流程中，我们通常会通过 JS 操作 DOM (对应 HTML 的描述产生的树)，以引起界面的一些变化响应用户的行为。例如，用户点击某个按钮的时候，JS 会记录一些状态到 JS 变量里边，同时通过 DOM API 操控 DOM 的属性或者行为，进而引起界面一些变化。当项目越来越大的时候，你的代码会充斥着非常多的界面交互逻辑和程序的各种状态变量，显然这不是一个很好的开发模式，因此就有了 MVVM 的开发模式（例如 React, Vue），提倡把渲染和逻辑分离。简单来说就是不要再让 JS 直接操控 DOM，JS 只需要管理状态即可，然后再通过一种模板语法来描述状态和界面结构的关系即可。

<img :src="$withBase('/mvvm.png')" />

小程序的框架也是用到了这个思路，如果你需要把一个 Hello World 的字符串显示在界面上。

**WXML 是这么写 :**
```HTML
<text>{{text}}</text>
```
JS 只需要管理状态即可:
```JS
this.setData({ msg: "Hello World" })
```
> 通过 {{ }} 的语法把一个变量绑定到界面上，我们称为数据绑定。仅仅通过数据绑定还不够完整的描述状态和界面的关系，还需要 if/else, for等控制能力，在小程序里边，这些控制能力都用 wx: 开头的属性来表达。

### .wxss 后缀的 WXSS 样式文件

- WXSS 具有 CSS 大部分的特性

**WXSS扩展和新增**
- 1、新增尺寸单位。WXSS在底层支持新的尺寸单位px。由于换算采用的是浮点数运算，所以运算结果和预期结果有一点点偏差
- 2、提供全局样式和局部样式。和app.json，page.json概念相同，可以写一个app.wxss作为全局样式。
- 3、WXSS仅支持部分CSS选择器。

### .js 后缀的 JS 脚本逻辑文件
- 一个服务仅仅只有界面展示是不够的，还需要和用户做交互：响应用户的点击、获取用户的位置等等。在小程序里边，我们就通过编写 JS 脚本文件来处理用户的操作。如下面的例子：

```HTML
    <view>{{ msg }}</view>
    <button bindtap="clickMe">点击我</button>
```

```js
    Page({
        clickMe:function(){
            this.setData({ msg:"Hello World" })
        }
    })
```
- 更多的相应事件操作，[可参考](https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxml/event.html)
  
> 可以在 JS 中调用小程序提供的丰富的 API，利用这些 API 可以很方便的调起微信提供的能力，例如获取用户信息、本地存储、微信支付等。